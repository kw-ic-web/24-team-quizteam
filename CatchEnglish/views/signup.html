<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signup</title>
    <link rel="stylesheet" href="/stylesheets/signup.css" />
</head>
<body>
    <div class="signup-container">
        <h2>회원가입</h2>
        <form action="/api/users/signup" method="post" class="signup-form">
            <label for="name">이름</label>
            <input type="text" id="name" name="name" required>

            <label for="dob">생년월일</label>
            <input type="date" id="dob" name="dob" required>

            <label for="userid">아이디</label>
            <input type="text" id="userid" name="userid" required>
            <button type="button" id="checkUserIdButton">아이디 중복 확인</button>

            <label for="password">비밀번호</label>
            <input type="password" id="password" name="password" required>

            <label for="confirm-password">비밀번호 확인</label>
            <input type="password" id="confirm-password" name="confirm-password" required>

            <button type="submit" id="signupButton" disabled>회원가입</button>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const signupButton = document.getElementById("signupButton");
            const checkUserIdButton = document.getElementById("checkUserIdButton");
            const passwordField = document.getElementById("password");
            const confirmPasswordField = document.getElementById("confirm-password");
            const useridField = document.getElementById("userid");

            let isUserIdValid = false;

            function validateForm() {
                const password = passwordField.value;
                const confirmPassword = confirmPasswordField.value;
                const name = document.getElementById("name").value;
                const dob = document.getElementById("dob").value;

                signupButton.disabled = !(
                    isUserIdValid &&
                    password === confirmPassword &&
                    name &&
                    dob &&
                    useridField.value
                );
            }

            checkUserIdButton.addEventListener("click", async () => {
                const userid = useridField.value;
                const response = await fetch(`/api/users/check-duplicate-id?userid=${userid}`);
                const data = await response.json();

                if (data.exists) {
                    isUserIdValid = false;
                    alert("이미 존재하는 아이디입니다.");
                } else {
                    isUserIdValid = true;
                    alert("사용 가능한 아이디입니다.");
                }
                validateForm();
            });

            passwordField.addEventListener("input", validateForm);
            confirmPasswordField.addEventListener("input", validateForm);
            useridField.addEventListener("input", () => {
                isUserIdValid = false;
                validateForm();
            });

            document.getElementById("name").addEventListener("input", validateForm);
            document.getElementById("dob").addEventListener("input", validateForm);
        });
    </script>
</body>
</html>
